# Maintainer: axiom <hello@axiom.co>
# Contributor: axiom <hello@axiom.co>

pkgname=axiom-bin
pkgver=0.0.0  # This will be updated by the release process
pkgrel=1
pkgdesc="Powerful log analytics from the comfort of your command-line"
arch=('x86_64' 'aarch64')
url="https://axiom.co"
license=('MIT')
provides=('axiom-bin')
conflicts=('axiom-bin' 'axiom-git')
depends=()
makedepends=()

# Architecture-specific source URLs
source_x86_64=("${pkgname}-${pkgver}-x86_64.tar.gz::https://github.com/axiomhq/cli/releases/download/v${pkgver}/axiom_${pkgver}_linux_amd64.tar.gz")
source_aarch64=("${pkgname}-${pkgver}-aarch64.tar.gz::https://github.com/axiomhq/cli/releases/download/v${pkgver}/axiom_${pkgver}_linux_arm64.tar.gz")

# SHA256 checksums - these will be updated during the release process
sha256sums_x86_64=('SKIP')
sha256sums_aarch64=('SKIP')

package() {
  cd "${srcdir}"

  # Install binary
  install -Dm755 "./axiom" "${pkgdir}/usr/bin/axiom"

  # Install license
  install -Dm644 "./LICENSE" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"

  # Install man pages
  if [ -d "./man" ]; then
    for manfile in ./man/*.1; do
      [ -f "$manfile" ] && install -Dm644 "$manfile" "${pkgdir}/usr/share/man/man1/$(basename $manfile)"
    done
  fi

  # Generate and install shell completions
  # Note: We generate these at package time to ensure they're up-to-date
  if [ -f "./axiom" ]; then
    # Bash completion
    mkdir -p "${pkgdir}/usr/share/bash-completion/completions"
    "./axiom" completion bash > "${pkgdir}/usr/share/bash-completion/completions/axiom" 2>/dev/null || true

    # Zsh completion
    mkdir -p "${pkgdir}/usr/share/zsh/site-functions"
    "./axiom" completion zsh > "${pkgdir}/usr/share/zsh/site-functions/_axiom" 2>/dev/null || true

    # Fish completion
    mkdir -p "${pkgdir}/usr/share/fish/vendor_completions.d"
    "./axiom" completion fish > "${pkgdir}/usr/share/fish/vendor_completions.d/axiom.fish" 2>/dev/null || true
  fi

  # Install README if it exists
  [ -f "./README.md" ] && install -Dm644 "./README.md" "${pkgdir}/usr/share/doc/${pkgname}/README.md"
}

# vim: set ts=2 sw=2 et:
